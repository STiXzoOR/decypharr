{{ define "index" }}
<div class="space-y-6">

    {{ if .NeedSetup }}
    <div role="alert" class="alert alert-warning">
        <i class="bi bi-exclamation-triangle text-xl"></i>
        <div>
            <h3 class="font-bold">Configuration Required</h3>
            <div class="text-sm">Your configuration is incomplete. Please complete the setup in the <a href="{{.URLBase}}settings" class="link link-hover font-semibold">Settings page</a>.</div>
        </div>
    </div>
    {{ end }}

    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                <div class="flex items-center gap-2">
                    <button class="btn btn-secondary btn-sm hidden" id="batchDeleteBtn">
                        <i class="bi bi-trash"></i>
                        <span class="hidden sm:inline">Delete Selected</span>
                    </button>
                    <button class="btn btn-error btn-sm hidden" id="batchDeleteDebridBtn">
                        <i class="bi bi-cloud-fog-fill"></i>
                        <span class="hidden sm:inline">Remove From Debrid</span>
                    </button>
                    <button class="btn btn-outline btn-sm" id="refreshBtn">
                        <i class="bi bi-arrow-clockwise"></i>
                        <span class="hidden sm:inline">Refresh</span>
                    </button>
                </div>

                <div class="flex flex-wrap items-center gap-2 w-full lg:w-auto">
                    <div class="form-control">
                        <input type="text" id="searchInput" placeholder="Search torrents..."
                               class="input input-bordered input-sm w-full sm:w-64"
                               oninput="window.torrentDashboard.handleSearch(this.value)">
                    </div>
                    <select class="select select-bordered select-sm w-full sm:w-auto min-w-32" id="stateFilter">
                        <option value="">All States</option>
                        <option value="pausedUP">Completed</option>
                        <option value="downloading">Downloading</option>
                        <option value="error">Error</option>
                    </select>
                    <select class="select select-bordered select-sm w-full sm:w-auto min-w-32" id="categoryFilter">
                        <option value="">All Categories</option>
                    </select>
                    <select class="select select-bordered select-sm w-full sm:w-auto min-w-48" id="sortSelector">
                        <option value="added_on" selected>Date Added (Newest First)</option>
                        <option value="added_on_asc">Date Added (Oldest First)</option>
                        <option value="name_asc">Name (A-Z)</option>
                        <option value="name_desc">Name (Z-A)</option>
                        <option value="size_desc">Size (Largest First)</option>
                        <option value="size_asc">Size (Smallest First)</option>
                        <option value="progress_desc">Progress (Most First)</option>
                        <option value="progress_asc">Progress (Least First)</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div class="card bg-base-100 shadow-xl">
        <div class="card-body p-0">
            <div class="overflow-x-auto">
                <table class="table table-hover">
                    <thead class="bg-base-200">
                    <tr>
                        <th class="w-12">
                            <label class="cursor-pointer">
                                <input type="checkbox" class="checkbox checkbox-sm" id="selectAll">
                            </label>
                        </th>
                        <th class="font-semibold">
                            <i class="bi bi-file-text mr-2"></i>Name
                        </th>
                        <th class="font-semibold">
                            <i class="bi bi-hdd mr-2"></i>Size
                        </th>
                        <th class="font-semibold">
                            <i class="bi bi-speedometer2 mr-2"></i>Progress
                        </th>
                        <th class="font-semibold">
                            <i class="bi bi-download mr-2"></i>Speed
                        </th>
                        <th class="font-semibold">
                            <i class="bi bi-tag mr-2"></i>Category
                        </th>
                        <th class="font-semibold">
                            <i class="bi bi-cloud mr-2"></i>Debrid
                        </th>
                        <th class="font-semibold">
                            <i class="bi bi-people mr-2"></i>Seeders
                        </th>
                        <th class="font-semibold">
                            <i class="bi bi-activity mr-2"></i>State
                        </th>
                        <th class="font-semibold w-32">Actions</th>
                    </tr>
                    </thead>
                    <tbody id="torrentsList">
                    </tbody>
                </table>
            </div>

            <div class="flex flex-col sm:flex-row justify-between items-center p-6 border-t border-base-200 gap-4">
                <div class="text-sm text-base-content/70">
                    <span id="paginationInfo">Loading torrents...</span>
                </div>
                <div class="join" id="paginationControls"></div>
            </div>
        </div>
    </div>

    <div class="card bg-base-100 shadow-xl hidden" id="emptyState">
        <div class="card-body text-center py-16">
            <div class="text-6xl text-base-content/30 mb-4">
                <i class="bi bi-inbox"></i>
            </div>
            <h3 class="text-2xl font-bold mb-2">No Torrents Found</h3>
            <p class="text-base-content/70 mb-6">You haven't added any torrents yet. Start by adding your first download!</p>
            <a href="{{.URLBase}}download" class="btn btn-primary">
                <i class="bi bi-plus-circle mr-2"></i>Add New Download
            </a>
        </div>
    </div>
</div>

<ul class="menu bg-base-100 shadow-lg rounded-box context-menu hidden fixed z-50" id="torrentContextMenu">
    <li class="menu-title">
        <span class="torrent-name text-sm font-bold truncate max-w-48"></span>
    </li>
    <hr/>
    <li><a class="menu-item text-sm" data-action="copy-magnet">
        <i class="bi bi-magnet text-primary"></i>Copy Magnet Link
    </a></li>
    <li><a class="menu-item text-sm" data-action="copy-name">
        <i class="bi bi-clipboard text-info"></i>Copy Name
    </a></li>
    <hr/>
    <li><a class="menu-item text-sm text-error" data-action="delete">
        <i class="bi bi-trash"></i>Delete Torrent
    </a></li>
</ul>

<!-- Torrent Details Modal -->
<dialog id="torrentDetailsModal" class="modal">
    <div class="modal-box max-w-4xl max-h-[90vh]">
        <form method="dialog">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">X</button>
        </form>

        <h3 class="font-bold text-xl mb-6 pr-8" id="modalTorrentName">-</h3>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
            <!-- Torrent Info Card -->
            <div class="card bg-base-200">
                <div class="card-body p-4">
                    <h4 class="card-title text-sm mb-3">
                        <i class="bi bi-info-circle text-primary mr-2"></i>Torrent Info
                    </h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="opacity-70">Hash:</span>
                            <span class="font-mono text-xs truncate max-w-[200px]" id="modalHash">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="opacity-70">Size:</span>
                            <span id="modalSize">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="opacity-70">Progress:</span>
                            <span id="modalProgress">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="opacity-70">Speed:</span>
                            <span id="modalSpeed">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="opacity-70">Added:</span>
                            <span id="modalAddedOn">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Card -->
            <div class="card bg-base-200">
                <div class="card-body p-4">
                    <h4 class="card-title text-sm mb-3">
                        <i class="bi bi-bar-chart text-info mr-2"></i>Statistics
                    </h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="opacity-70">Category:</span>
                            <span class="badge badge-secondary badge-sm" id="modalCategory">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="opacity-70">Debrid:</span>
                            <span class="badge badge-accent badge-sm" id="modalDebrid">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="opacity-70">State:</span>
                            <span class="badge badge-sm" id="modalState">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="opacity-70">Seeders:</span>
                            <span id="modalSeeders">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="opacity-70">Downloaded:</span>
                            <span id="modalDownloaded">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Files Section -->
        <div class="card bg-base-200">
            <div class="card-body p-4">
                <h4 class="card-title text-sm mb-3">
                    <i class="bi bi-files text-success mr-2"></i>Files
                </h4>
                <div class="overflow-x-auto max-h-48">
                    <table class="table table-xs">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th class="text-right">Size</th>
                                <th class="text-right">Progress</th>
                            </tr>
                        </thead>
                        <tbody id="modalFilesBody">
                            <tr><td colspan="3" class="text-center opacity-50">Loading files...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="modal-action">
            <button class="btn btn-sm btn-outline" onclick="window.torrentDashboard.copyMagnetFromModal()">
                <i class="bi bi-magnet mr-1"></i>Copy Magnet
            </button>
            <button class="btn btn-sm btn-error" onclick="window.torrentDashboard.deleteFromModal()">
                <i class="bi bi-trash mr-1"></i>Delete
            </button>
            <form method="dialog">
                <button class="btn btn-sm">Close</button>
            </form>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        window.torrentDashboard = new TorrentDashboard();
        window.dashboard = window.torrentDashboard;
    });
</script>
{{ end }}